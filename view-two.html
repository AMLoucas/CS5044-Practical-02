<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title> View-Two </title>

	<style>
		.axis {
			font: 10px sans-serif;
		}

		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}
	</style>

</head>

<!-- Script organizing the data to visualize later. -->
<script>

	var dataPath = "data/top250-00-19.csv";

	// Margin variable to use to position visualisation more precise
	var margin = { top: 75, bottom: 75, left: 75, right: 75 };
	var width = 800 - margin.right - margin.left;	//width of the svg element (in pixels)
	var height = 400 - margin.top - margin.bottom; //height of the svg element


	// Reading the data in the javascript enviroment.
	d3.csv(dataPath)
		.then(function (data) {
			//  Printing in console to make sure all working correct
			console.log(data);

			//  Because we want to create a bar chart for the sum(fees) for every season
			//  We need to use nest() to group data according to the season of the observation
			var nestedBar = d3.nest()
				.key(function (d) {
					//  Specifying how we want to do the grouping
					return d.Season;
				})
				.rollup(function (leaves) {
					//  Specifying what attribute to sum for the bar chart (Transfer_fee)
					return d3.sum(leaves, function (d) {
						//  Need to tranform numbers to int because they are strings now.
						return parseInt(d.Transfer_fee)

					})
				})
				.entries(data); // Specifying on what data to do the grouping

			//  Printing new nested data in console to check if correct
			console.log(nestedBar);

			var nameData = d3.nest()
				.key(function (d) {
					// Which attribute i want the grouping to occur on
					return d.Season;
				})
				.rollup(function (leaves) {
					// specifying what we looking for
				})

			// DATA IS BEING USED TO PLOT NOW.

			// X-AXIS creation and domain.
			// Creating the width of all bar chart and padding between each bar
			var xScale = d3.scaleBand().range([0, width]).padding(0.05);
			// Giving the domain of the x-axis
			xScale.domain(nestedBar.map(function (d) { return d.key; }));

			//Y-AXIS creation and domain
			var yScale = d3.scaleLinear().range([height, 0]);
			// Giving the domain from 0(since no transfers = 0) to the maximum transfer sum season.
			yScale.domain([0, d3.max(nestedBar, function (d) { return parseInt(d.value); })]);


			// Creation of svg element.
			var svg = d3.select("#Bar_Chart")
				.append('svg')
				.attr('height', height + margin.top + margin.bottom)
				.attr("width", width + margin.left + margin.right)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// to be able to use x axis to css
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0, " + height + ")")
				.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
				.selectAll("text")
				.style("text-anchor", "end") // labels the axis all below the line
				.attr("dx", "-.8em")
				.attr("dy", "-.55em")
				.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

			// to be able to use y axis to css
			svg.append("g")
				.attr("class", "y axis")
				.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end");
			/**
			 * STILL NEED TO PUT GOOD LABELS ON AXIS AND TITLE TO BE MORE FRIENDLY
			 **/

			// Selecting or bars created from scaleBand. One bar for each value in domain.
			svg.selectAll("bar")
				.data(nestedBar) // Data being used.
				.enter().append("rect") // Each bar create rectangle
				.style("fill", "steelblue")
				.attr("class", "bar")
				.attr("x", function (d) { return xScale(d.key); }) // Placing bar at value xScale on x axis
				.attr("y", function (d) { return yScale(d.value); }) // Ending height at value yScale on y axis
				.attr("width", xScale.bandwidth()) // Specifyin the width of each bar according to the bar widths (finds it auto)
				.attr("height", function (d) { return height - yScale(d.value); });


		});
</script>

<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="view-one.html">View One</a></li>
			<li class="current"><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>
	<h2>Second view of data here.</h2>

	<!-- Visualisation will be appeared. -->
	<div id="Bar_Chart">

	</div>



	<script src="https://d3js.org/d3.v5.js"></script>
</body>

</html>