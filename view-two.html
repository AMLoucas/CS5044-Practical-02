<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title> View-Two </title>

	<style>

		.axis path,
		.axis line {
			fill: none;
			stroke: #000;
			shape-rendering: crispEdges;
		}

		.Laliga {
			fill: none;
			stroke: red;
		}

		.Premier {
			fill:none;
			stroke:blue;
		}

		.Bundesliga {
			fill: none;
			stroke: green;
		}

		.SerieA {
			fill: none;
			stroke: black;
		}

		.Ligue1 {
			fill: none;
			stroke: darkmagenta;
		}
	</style>

</head>

<!-- Script organizing the data to visualize later. -->
<script>

	var dataPath = "data/top250-00-19.csv";

	// Margin variable to use to position visualisation more precise
	var margin = { top: 75, bottom: 75, left: 75, right: 75 };
	var width = 800 - margin.right - margin.left;	//width of the svg element (in pixels)
	var height = 400 - margin.top - margin.bottom; //height of the svg element
	//have a starting state
	sortBySeason();

	function selectSort(option) {
		if (option.localeCompare("1") == 0){
			sortBySeason();
		}
		else {
			sortByPosition();
		}
	}

	function sortBySeason() {
	// Reading the data in the javascript enviroment.
	d3.csv(dataPath)
		.then(function (data) {

			//  Because we want to create a bar chart for the sum(fees) for every season
			//  We need to use nest() to group data according to the season of the observation
			var dataBy_Season = d3.nest()
					.key(function (d) {
						//  Specifying how we want to do the grouping
						return d.Season;
					})
					.rollup(function (leaves) {
						//  Specifying what attribute to sum for the bar chart (Transfer_fee)
						return d3.sum(leaves, function (d) {
							//  Need to tranform numbers to int because they are strings now.
							return parseInt(d.Transfer_fee)

						})
					})
					.entries(data); // Specifying on what data to do the grouping
			createBy(dataBy_Season);
		});

		};

		function sortByPosition() {
			// Reading the data in the javascript enviroment.
			d3.csv(dataPath)
					.then(function (data) {


			// Create Bar Graph by position.
			var dataBy_Position = d3.nest()
					.key(function (d) {
						// Which attribute i want the grouping to occur on
						return d.Position;
					})
					.rollup(function (leaves) {
						//  Specifying what attribute to sum for the bar chart (Transfer_fee)
						return d3.sum(leaves, function (d) {
							//  Need to tranform numbers to int because they are strings now.
							return parseInt(d.Transfer_fee)

						})
					})
					.entries(data);

			createBy(dataBy_Position);
					});

		};

	function createBy(data) {
		document.getElementById("Bar_Chart").innerHTML = "";

			// DATA IS BEING USED TO PLOT NOW.

			// X-AXIS creation and domain.
			// Creating the width of all bar chart and padding between each bar
			var xScale = d3.scaleBand().range([0, width]).padding(0.05);
			// Giving the domain of the x-axis
			xScale.domain(data.map(function (d) { return d.key; }));

			//Y-AXIS creation and domain
			var yScale = d3.scaleLinear().range([height, 0]);
			// Giving the domain from 0(since no transfers = 0) to the maximum transfer sum season.
			yScale.domain([0, d3.max(data, function (d) { return parseInt(d.value); })]);


			// Creation of svg element.
			var svg = d3.select("#Bar_Chart")
				.append('svg')
				.attr('height', height + margin.top + margin.bottom)
				.attr("width", width + margin.left + margin.right)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// to be able to use x axis to css
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0, " + height + ")")
				.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
				.selectAll("text")
				.style("text-anchor", "end") // labels the axis all below the line
				.attr("dx", "-.8em")
				.attr("dy", "-.55em")
				.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

			// to be able to use y axis to css
			svg.append("g")
				.attr("class", "y axis")
				.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end");
			/**
			 * STILL NEED TO PUT GOOD LABELS ON AXIS AND TITLE TO BE MORE FRIENDLY
			 **/

			// Selecting or bars created from scaleBand. One bar for each value in domain.
			svg.selectAll("bar")
				.data(data) // Data being used.
				.enter().append("rect") // Each bar create rectangle
				.style("fill", "steelblue")
				.attr("class", "bar")
				.attr("x", function (d) { return xScale(d.key); }) // Placing bar at value xScale on x axis
				.attr("y", function (d) { return yScale(d.value); }) // Ending height at value yScale on y axis
				.attr("width", xScale.bandwidth()) // Specifyin the width of each bar according to the bar widths (finds it auto)
				.attr("height", function (d) { return height - yScale(d.value); });


		}

</script>

<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="view-one.html">View One</a></li>
			<li class="current"><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>
	<h2>Second view of data here.</h2>
	<form id = "sort_by">
		<label for="data">Which data to compare:</label>
		<select id="data" onchange="selectSort(this.value)">
			<option value="1">By Season</option>
			<option value="2">By Player's Position</option>
		</select>
	</form>

	<!-- Visualisation will be appeared. -->
	<div id="Bar_Chart">

	</div>

	<script>
		// Reading the data in the javascript enviroment.
		d3.csv(dataPath)
				.then(function (data) {

					//  Because we want to create a bar chart for the sum(fees) for every season
					//  We need to use nest() to group data according to the season of the observation
					var data_for_line= d3.nest()
							.key(function (d) {
								//  Specifying how we want to do the grouping
								return d.League_to;
							})
							.key(function (e){
								// Specifying the second grouping looking for.
								return e.Position;
							})
							.rollup(function (leaves) {
								//  Specifying what attribute to sum for the bar chart (Transfer_fee)
								return d3.sum(leaves, function (d) {
									//  Need to tranform numbers to int because they are strings now.
									return parseInt(d.Transfer_fee)

								})
							})
							.entries(data); // Specifying on what data to do the grouping

					var domain_x = d3.nest()
							.key(function (e){
								// Specifying the second grouping looking for.
								return e.Position;
							})
							.rollup(function (leaves) {
								//  Specifying what attribute to sum for the bar chart (Transfer_fee)
								return d3.sum(leaves, function (d) {
									//  Need to tranform numbers to int because they are strings now.
									return parseInt(d.Transfer_fee)

								})
							})
							.entries(data); // Specifying on what data to do the grouping

					// Keep only top 5 leagues in data.
					let league_interest = ["LaLiga", "Serie A", "Premier League", "Ligue 1", "1.Bundesliga"];

					// Getting iterator index of the leagues interested in array frame.
					var iterator_interest = new Array();
					var i = 0;
					data_for_line.forEach(function(d){
						if (league_interest.includes(d.key)){
							iterator_interest.push(i);
						}
						i = i + 1;
					});

					var final = new Array();
					iterator_interest.forEach(function (iter){
						final.push(data_for_line[iter]);
					});



					// X-AXIS creation and domain.
					// Creating x axis scale and domain.
					var positions = new Array()
					domain_x.forEach(function (d) {
						positions.push(d.key);
					});

					var xScale = d3.scaleBand()
							.range([0, width])
							.domain(positions.sort());

					// Y-AXIS creation and domain.
					var transfer_per = new Array();
					final.forEach(function(d){
						(d.values).forEach(function(e){transfer_per.push(e.value);})
					});

					var y_ax = d3.extent(transfer_per, function(d){return parseInt(d);});
					var yScale = d3.scaleLinear()
							.range([height, 0])
							.domain(y_ax);




					// Creation of svg element.
					var svg = d3.select("#Line_Chart")
							.append('svg')
							.attr('height', height + margin.top + margin.bottom)
							.attr("width", width + margin.left + margin.right)
							.append("g")
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					// to be able to use x axis to css
					// and plotting
					svg.append("g")
							.attr("class", "x axis")
							.attr("transform", "translate(0, " + height + ")")
							.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
							.selectAll("text")
							.style("text-anchor", "end") // labels the axis all below the line
							.attr("dx", "-.8em")
							.attr("dy", "-.55em")
							.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

					// to be able to use y axis to css
					// and plotting
					svg.append("g")
							.attr("class", "y axis")
							.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 6)
							.attr("dy", ".71em")
							.style("text-anchor", "end");

					var lineGenerator = d3.line()
							.x(function(d){
								return (margin.left + margin.right + xScale(d.key));
							})
							.y(function(d){
								return yScale(parseInt(d.value));
							});


					console.log(final);


					// Creating the lines in graphs.
					svg.append("path")
							.datum(final[0].values) // Data being used.
							.attr("class", "Laliga")
							.attr("d", lineGenerator);

					// Creating the lines in graphs.
					svg.append("path")
							.datum(final[1].values) // Data being used.
							.attr("class", "SerieA")
							.attr("d", lineGenerator);

					// Creating the lines in graphs.
					svg.append("path")
							.datum(final[2].values) // Data being used.
							.attr("class", "Ligue1")
							.attr("d", lineGenerator);

					// Creating the lines in graphs.
					svg.append("path")
							.datum(final[3].values) // Data being used.
							.attr("class", "Premier")
							.attr("d", lineGenerator);

					// Creating the lines in graphs.
					svg.append("path")
							.datum(final[4].values) // Data being used.
							.attr("class", "Bundesliga")
							.attr("d", lineGenerator);




				});

	</script>
	<!-- Line graph of different leagues will appear -->
	<div id="Line_Chart">

	</div>


</body>

</html>