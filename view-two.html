<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title> View-Two </title>

	<style>




		.Laliga {
			stroke: red;
			stroke-width: 0.5px;
			fill: red;
			opacity: 0.75;

		}

		.Premier {
			stroke: blue;
			stroke-width: 0.5px;
			fill: blue;
			opacity: 0.75;
		}

		.Bundesliga {
			stroke: green;
			stroke-width: 0.5px;
			fill: green;
			opacity: 0.75;
		}

		.SerieA {
			stroke: black;
			stroke-width: 0.5px;
			fill: black;
			opacity: 0.75;
		}

		.Ligue1 {
			stroke: orange;
			stroke-width: 0.5px;
			fill: orange;
			opacity: 0.75;
		}
	</style>

</head>

<!-- Script organizing the data to visualize later. -->
<script>

	var dataPath = "data/top250-00-19.csv";

	// Margin variable to use to position visualisation more precise
	var margin = { top: 75, bottom: 75, left: 75, right: 75 };
	var width = 800 - margin.right - margin.left;	//width of the svg element (in pixels)
	var height = 400 - margin.top - margin.bottom; //height of the svg element
	//have a starting state
	sortBySeason();

	function selectSort(option) {
		if (option.localeCompare("1") == 0){
			sortBySeason();
		}
		else {
			sortByPosition();
		}
	}

	function sortBySeason() {
	// Reading the data in the javascript enviroment.
	d3.csv(dataPath)
		.then(function (data) {

			//  Because we want to create a bar chart for the sum(fees) for every season
			//  We need to use nest() to group data according to the season of the observation
			var dataBy_Season = d3.nest()
					.key(function (d) {
						//  Specifying how we want to do the grouping
						return d.Season;
					})
					.rollup(function (leaves) {
						//  Specifying what attribute to sum for the bar chart (Transfer_fee)
						return d3.sum(leaves, function (d) {
							//  Need to tranform numbers to int because they are strings now.
							return parseInt(d.Transfer_fee)

						})
					})
					.entries(data); // Specifying on what data to do the grouping
			createBy(dataBy_Season);
		});

		};

		function sortByPosition() {
			// Reading the data in the javascript enviroment.
			d3.csv(dataPath)
					.then(function (data) {


			// Create Bar Graph by position.
			var dataBy_Position = d3.nest()
					.key(function (d) {
						// Which attribute i want the grouping to occur on
						return d.Position;
					})
					.rollup(function (leaves) {
						//  Specifying what attribute to sum for the bar chart (Transfer_fee)
						return d3.sum(leaves, function (d) {
							//  Need to tranform numbers to int because they are strings now.
							return parseInt(d.Transfer_fee)

						})
					})
					.entries(data);

			createBy(dataBy_Position);
					});

		};

	function createBy(data) {
		document.getElementById("Bar_Chart").innerHTML = "";

			// DATA IS BEING USED TO PLOT NOW.

			// X-AXIS creation and domain.
			// Creating the width of all bar chart and padding between each bar
			var xScale = d3.scaleBand().range([0, width]).padding(0.05);
			// Giving the domain of the x-axis
			xScale.domain(data.map(function (d) { return d.key; }));

			//Y-AXIS creation and domain
			var yScale = d3.scaleLinear().range([height, 0]);
			// Giving the domain from 0(since no transfers = 0) to the maximum transfer sum season.
			yScale.domain([0, d3.max(data, function (d) { return parseInt(d.value); })]);


			// Creation of svg element.
			var svg = d3.select("#Bar_Chart")
				.append('svg')
				.attr('height', height + margin.top + margin.bottom)
				.attr("width", width + margin.left + margin.right)
				.append("g")
				.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

			// to be able to use x axis to css
			svg.append("g")
				.attr("class", "x axis")
				.attr("transform", "translate(0, " + height + ")")
				.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
				.selectAll("text")
				.style("text-anchor", "end") // labels the axis all below the line
				.attr("dx", "-.8em")
				.attr("dy", "-.55em")
				.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

			// to be able to use y axis to css
			svg.append("g")
				.attr("class", "y axis")
				.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
				.append("text")
				.attr("transform", "rotate(-90)")
				.attr("y", 6)
				.attr("dy", ".71em")
				.style("text-anchor", "end");
			/**
			 * STILL NEED TO PUT GOOD LABELS ON AXIS AND TITLE TO BE MORE FRIENDLY
			 **/

			// Selecting or bars created from scaleBand. One bar for each value in domain.
			svg.selectAll("bar")
				.data(data) // Data being used.
				.enter().append("rect") // Each bar create rectangle
				.style("fill", "steelblue")
				.attr("class", "bar")
				.attr("x", function (d) { return xScale(d.key); }) // Placing bar at value xScale on x axis
				.attr("y", function (d) { return yScale(d.value); }) // Ending height at value yScale on y axis
				.attr("width", xScale.bandwidth()) // Specifyin the width of each bar according to the bar widths (finds it auto)
				.attr("height", function (d) { return height - yScale(d.value); });


		}

</script>

<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="view-one.html">View One</a></li>
			<li class="current"><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>
	<h2>Second view of data here.</h2>
	<form id = "sort_by">
		<label for="data">Which data to compare:</label>
		<select id="data" onchange="selectSort(this.value)">
			<option value="1">By Season</option>
			<option value="2">By Player's Position</option>
		</select>
	</form>

	<!-- Visualisation will be appeared. -->
	<div id="Bar_Chart">

	</div>

	<script>
		// Reading the data in the javascript enviroment.
		d3.csv(dataPath)
				.then(function (data) {

					//  Because we want to create a bar chart for the sum(fees) for every season
					//  We need to use nest() to group data according to the season of the observation
					var data_for_line= d3.nest()
							.key(function (d) {
								//  Specifying how we want to do the grouping
								return d.League_to;
							})
							.key(function (e){
								// Specifying the second grouping looking for.
								return e.Position;
							})
							.rollup(function (leaves) {
								//  Specifying what attribute to sum for the bar chart (Transfer_fee)
								return d3.sum(leaves, function (d) {
									//  Need to tranform numbers to int because they are strings now.
									return parseInt(d.Transfer_fee)

								})
							})
							.entries(data); // Specifying on what data to do the grouping

					var domain_x = d3.nest()
							.key(function (e){
								// Specifying the second grouping looking for.
								return e.Position;
							})
							.rollup(function (leaves) {
								//  Specifying what attribute to sum for the bar chart (Transfer_fee)
								return d3.sum(leaves, function (d) {
									//  Need to tranform numbers to int because they are strings now.
									return parseInt(d.Transfer_fee)

								})
							})
							.entries(data); // Specifying on what data to do the grouping

					// Keep only top 5 leagues in data.
					let league_interest = ["LaLiga", "Serie A", "Premier League", "Ligue 1", "1.Bundesliga"];

					// Getting iterator index of the leagues interested in array frame.
					var iterator_interest = new Array();
					var i = 0;
					data_for_line.forEach(function(d){
						if (league_interest.includes(d.key)){
							iterator_interest.push(i);
						}
						i = i + 1;
					});

					var final = new Array();
					iterator_interest.forEach(function (iter){
						final.push(data_for_line[iter]);
					});

					/**
					 * Function for compare to sort the array of objects using each objects key.
					 * Code was found from https://www.sitepoint.com/sort-an-array-of-objects-in-javascript/
					 * Using code from here to do the sorting.
					 */
					function compare(a, b) {
						// Use toUpperCase() to ignore character casing
						const keyA = a.key.toUpperCase();
						const keyB = b.key.toUpperCase();

						let comparison = 0;
						if (keyA > keyB) {
							comparison = 1;
						} else if (keyA < keyB) {
							comparison = -1;
						}
						return comparison;
					}

					// Sorting each object (each league) according to position of player.
					final.forEach(function(d) {
						d.values.sort(compare);
						console.log(d.values);
					});


					// X-AXIS creation and domain.
					// Creating x axis scale and domain.
					var positions = new Array()
					domain_x.forEach(function (d) {
						positions.push(d.key);
					});

					// Using scale point so lines are plotted more precisely.
					var xScale = d3.scalePoint()
							.range([50, width+50]) // Start from 50 because dont want both axis to be stuck.
							.domain(positions.sort());

					// Y-AXIS creation and domain.
					var transfer_per = new Array();
					final.forEach(function(d){
						(d.values).forEach(function(e){transfer_per.push(e.value);})
					});

					// Getting the y axis creation and domain.
					var y_ax = d3.extent(transfer_per, function(d){return parseInt(d);});
					var yScale = d3.scaleLinear()
							.range([height, 0])
							.domain(y_ax);




					// Creation of svg element.
					var svgLine = d3.select("#Line_Chart")
							.append('svg')
							.attr('class', 'LineSVG')
							.attr('height', height + margin.top + margin.bottom)
							.attr("width", width + margin.left + margin.right)
							.style("margin-left", margin.left)
							.append("g")
							.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

					// to be able to use x axis to css
					// and plotting
					svgLine.append("g")
							.attr("class", "x axis")
							.attr("transform", "translate(0, " + height + ")")
							.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
							.selectAll("text")
							.style("text-anchor", "end") // labels the axis all below the line
							.attr("dx", "-.8em")
							.attr("dy", "-.55em")
							.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

					// to be able to use y axis to css
					// and plotting
					svgLine.append("g")
							.attr("class", "y axis")
							.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
							.append("text")
							.attr("transform", "rotate(-90)")
							.attr("y", 6)
							.attr("dy", ".71em")
							.style("text-anchor", "end");


					console.log(final);


					// Appending points for Laliga
					svgLine.selectAll("liga-dots")
							.data(final[0].values) // Data being used.
							.enter()
							.append("svg:circle")
							.attr("class", "Laliga")
							.attr("cx", function(d){
								return xScale(d.key);
							})
							.attr("cy", function(d){
								return yScale(parseInt(d.value))
							})
							.attr("r", 5)
							.on("mouseover",function(d) {
								d3.select('.LineSVG')
										.append("text")
										.attr("class", "tooltip")
										.text("LaLiga spend : " + parseInt(d.value/1000000) +  "M on position : " + d.key)
										.attr("x", xScale(d.key))
										.attr("y",
												yScale(parseInt(d.value)) + 70);

								})
								.on("mouseout",function(d){
									d3.selectAll(".tooltip")
											.remove();
								});

								// Appending points for Serie A league.
								svgLine.selectAll("serie-dots")
										.data(final[1].values) // Data being used.
										.enter()
										.append("circle")
										.attr("class", "SerieA")
										.attr("cx", function (d) {
											return xScale(d.key);
										})
										.attr("cy", function (d) {
											return yScale(parseInt(d.value))
										})
										.attr("r", 5)
										.on("mouseover",function(d) {
											d3.select('.LineSVG')
													.append("text")
													.attr("class", "tooltip")
													.text("Serie A spend : " + parseInt(d.value/1000000) +  "M on position : " + d.key)
													.attr("x", xScale(d.key))
													.attr("y",
															yScale(parseInt(d.value)) + 70);

										})
										.on("mouseout",function(d){
											d3.selectAll(".tooltip")
													.remove();
										});


								// Appending points for Ligue 1 league.
								svgLine.selectAll("ligue-dots")
										.data(final[2].values) // Data being used.
										.enter()
										.append("circle")
										.attr("class", "Ligue1")
										.attr("cx", function (d) {
											return xScale(d.key);
										})
										.attr("cy", function (d) {
											return yScale(parseInt(d.value))
										})
										.attr("r", 5)
										.on("mouseover",function(d) {
											d3.select('.LineSVG')
													.append("text")
													.attr("class", "tooltip")
													.text("Ligue 1 spend : " + parseInt(d.value/1000000) +  "M on position : " + d.key)
													.attr("x", xScale(d.key))
													.attr("y", yScale(parseInt(d.value)) + 70 );

										})
										.on("mouseout",function(d){
											d3.selectAll(".tooltip")
													.remove();
										});

								// Appending points for Premier league.
								svgLine.selectAll("premier-dot")
										.data(final[3].values) // Data being used.
										.enter()
										.append("circle")
										.attr("class", "Premier")
										.attr("cx", function (d) {
											return xScale(d.key);
										})
										.attr("cy", function (d) {
											return yScale(parseInt(d.value))
										})
										.attr("r", 5)
										.on("mouseover",function(d) {
											d3.select('.LineSVG')
													.append("text")
													.attr("class", "tooltip")
													.text("Premier League spend : " + parseInt(d.value/1000000) +  "M on position : " + d.key)
													.attr("x", xScale(d.key))
													.attr("y", yScale(parseInt(d.value)) + 70);

										})
										.on("mouseout",function(d){
											d3.selectAll(".tooltip")
													.remove();
										});

								// Appending points for Bundesliga.
								svgLine.selectAll("bundes-dot")
										.data(final[4].values) // Data being used.
										.enter()
										.append("circle")
										.attr("class", "Bundesliga")
										.attr("cx", function (d) {
											return xScale(d.key);
										})
										.attr("cy", function (d) {
											return yScale(parseInt(d.value))
										})
										.attr("r", 5)
										.on("mouseover",function(d) {
											d3.select('.LineSVG')
													.append("text")
													.attr("class", "tooltip")
													.text("Bundesliga spend : " + parseInt(d.value/1000000) +  "M on position : " + d.key)
													.attr("x", xScale(d.key))
													.attr("y", yScale(parseInt(d.value)) +70 );

										})
										.on("mouseout",function(d){
											d3.selectAll(".tooltip")
													.remove();
										});
							});

	</script>
	<!-- Line graph of different leagues will appear -->
	<div id="Line_Chart">

	</div>


</body>

</html>