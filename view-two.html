<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title> View-Two </title>

	<style>

		* {
			box-sizing: border-box;
		}

		/* Create three unequal columns that floats next to each other */
		.column {
			float: left;
			padding: 10px;
			height: 300px; /* Should be removed. Only for demonstration */
		}

		.left {
			width: 15%;
		}

		.middle, .right {
			width: 35%;
		}

		/* Clear floats after the columns */
		.row:after {
			content: "";
			display: table;
			clear: both;
		}



		.Laliga {
			stroke: red;
			stroke-width: 0.5px;
			fill: red;
			opacity: 0.75;

		}

		.Premier {
			stroke: blue;
			stroke-width: 0.5px;
			fill: blue;
			opacity: 0.75;
		}

		.Bundesliga {
			stroke: green;
			stroke-width: 0.5px;
			fill: green;
			opacity: 0.75;
		}

		.SerieA {
			stroke: black;
			stroke-width: 0.5px;
			fill: black;
			opacity: 0.75;
		}

		.Ligue1 {
			stroke: orange;
			stroke-width: 0.5px;
			fill: orange;
			opacity: 0.75;
		}
	</style>

</head>



<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li><a href="view-one.html">View One</a></li>
			<li class="current"><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>

	<div class="row">

		<!-- Checkbox list, so user chooses what seasons the data will be showing. -->
		<div class="column left">
			<!-- checkboxes for the season filtering -->
			<h3>Seasons interested:</h3>
			<form id="Range-Seasons">
				<input type="checkbox" id="season1" class="season-box" value="2000-2001" onchange="cleanDataToDraw()" checked>
				<label for="season1"> 2000-2001</label><br>
				<input type="checkbox" id="season2" class="season-box" value="2001-2002" onchange="cleanDataToDraw()" checked>
				<label for="season2"> 2001-2002</label><br>
				<input type="checkbox" id="season3" class="season-box" value="2002-2003" onchange="cleanDataToDraw()" checked>
				<label for="season3"> 2003-2003</label><br>
				<input type="checkbox" id="season4" class="season-box" value="2003-2004" onchange="cleanDataToDraw()" checked>
				<label for="season4"> 2003-2004</label><br>
				<input type="checkbox" id="season5" class="season-box" value="2004-2005" onchange="cleanDataToDraw()" checked>
				<label for="season5"> 2005-2005</label><br>
				<input type="checkbox" id="season6" class="season-box" value="2005-2006" onchange="cleanDataToDraw()" checked>
				<label for="season6"> 2005-2006</label><br>
				<input type="checkbox" id="season7" class="season-box" value="2006-2007" onchange="cleanDataToDraw()" checked>
				<label for="season7"> 2006-2007</label><br>
				<input type="checkbox" id="season8" class="season-box" value="2007-2008" onchange="cleanDataToDraw()" checked>
				<label for="season8"> 2007-2008</label><br>
				<input type="checkbox" id="season9" class="season-box" value="2008-2009" onchange="cleanDataToDraw()" checked>
				<label for="season9"> 2008-2009</label><br>
				<input type="checkbox" id="season10" class="season-box" value="2009-2010" onchange="cleanDataToDraw()" checked>
				<label for="season10"> 2009-2010</label><br>
				<input type="checkbox" id="season11" class="season-box" value="2010-2011" onchange="cleanDataToDraw()" checked>
				<label for="season11"> 2010-2011</label><br>
				<input type="checkbox" id="season12" class="season-box" value="2011-2012" onchange="cleanDataToDraw()" checked>
				<label for="season12"> 2011-2012</label><br>
				<input type="checkbox" id="season13" class="season-box" value="2012-2013" onchange="cleanDataToDraw()" checked>
				<label for="season13"> 2012-2013</label><br>
				<input type="checkbox" id="season14" class="season-box" value="2013-2014" onchange="cleanDataToDraw()" checked>
				<label for="season14"> 2013-2014</label><br>
				<input type="checkbox" id="season15" class="season-box" value="2014-2015" onchange="cleanDataToDraw()" checked>
				<label for="season15"> 2014-2015</label><br>
				<input type="checkbox" id="season16" class="season-box" value="2015-2016" onchange="cleanDataToDraw()" checked>
				<label for="season16"> 2015-2016</label><br>
				<input type="checkbox" id="season17" class="season-box" value="2016-2017" onchange="cleanDataToDraw()" checked>
				<label for="season17"> 2016-2017</label><br>
				<input type="checkbox" id="season18" class="season-box" value="2017-2018" onchange="cleanDataToDraw()" checked>
				<label for="season18"> 2017-2018</label><br>
				<input type="checkbox" id="season19" class="season-box" value="2018-2019" onchange="cleanDataToDraw()" checked>
				<label for="season19"> 2018-2019</label><br>
				<br>
			</form>

			<!-- Checkboxes for Football League filtering -->
			<h3>Leagues interested in:</h3>
				<form id="league-range">
					<input type="checkbox" id="league1" value="Premier League" onchange="cleanDataToDraw()" checked>
					<label for="league1">Premier League</label><br>
					<input type="checkbox" id="league2" value="Ligue 1" onchange="cleanDataToDraw()" checked>
					<label for="league2">Ligue 1</label><br>
					<input type="checkbox" id="league3" value="1.Bundesliga" onchange="cleanDataToDraw()" checked>
					<label for="league3">Bundesliga</label><br>
					<input type="checkbox" id="league4" value="Serie A" onchange="cleanDataToDraw()" checked>
					<label for="league4">Serie A</label><br>
					<input type="checkbox" id="league5" value="LaLiga" onchange="cleanDataToDraw()" checked>
					<label for="league5">LaLiga</label><br>
				</form>
		</div>

		<!-- The part of the bar graph -->
		<div class="column middle">
			<!-- Visualisation will be appeared. -->
			<div id="Bar_Chart" style="width: 100%; height: 200%">
				<!-- Script organizing the data to visualize later. -->
				<script>
					// Reading in the data.
					var dataPath = "data/top250-00-19.csv";

					// Margin variable to use to position visualisation more precise
					var margin = { top: 75, bottom: 75, left: 75, right: 75 };
					// Getting height and width of the div elements the graphs will be inputted in.
					var width = document.getElementById('Bar_Chart').getBoundingClientRect().width ;	//width of the svg element (in pixels)
					var height = document.getElementById('Bar_Chart').getBoundingClientRect().height ; //height of the svg element

					// Calling function to draw the graphs needed.
					cleanDataToDraw();

					function cleanDataToDraw() {

						/**
						 * FILTERING DATA ACCORDING TO CHECKBOXES CHECKED FROM USER.
						 **/

						// Getting the data according to seasons interested in.
						var season_Selected = new Array();
						// Loop through all the seasons to check if checkboxes are checked (user wants)
						for (var i = 1; i<= 19; i++) {
							// Creating the string to check for a specific season if box checkes
							var season = "season"+i;
							// if box is checked then get the seasons value and input in array.
							if (document.getElementById(season).checked){
								season_Selected.push(document.getElementById(season).value);
							}
						}

						// Getting the data according to the leagues interested in.
						var league_Selected = new Array();
						// Loop through all top 5 leagues to check if checkboxes are checked (user wants)
						for (var i = 1; i<=5; i++) {
							// Creating the string to check for a specific league if box checked
							var league = "league"+i;
							// If the specific checkbox is checkes then we add the value in array.
							if (document.getElementById(league).checked) {
								league_Selected.push(document.getElementById(league).value);
							}
						}



						// Reading the data in the javascript environment for bar graph.
						d3.csv(dataPath)
								.then(function (data) {
									// Use of anonymous function
									// Filtering data and removing all records with seasons not interested in.
									data = data.filter(season => season_Selected.includes(season.Season));
									// Filtering the data to remove the leagues not interested in.
									data = data.filter(league => league_Selected.includes(league.League_to));


									//  Because we want to create a bar chart for the sum(fees) for every season
									//  We need to use nest() to group data according to the season of the observation
									var dataBy_Season = d3.nest()
											.key(function (d) {
												//  Specifying how we want to do the grouping
												if (season_Selected.includes(d.Season)) {
													return d.Season;
												}
											})
											.rollup(function (leaves) {
												//  Specifying what attribute to sum for the bar chart (Transfer_fee)
												return d3.sum(leaves, function (d) {
													//  Need to tranform numbers to int because they are strings now.
													return parseInt(d.Transfer_fee)

												})
											})
											.entries(data); // Specifying on what data to do the grouping
									//console.log(dataBy_Season);


									// Function to draw a bar graph.
									drawBarGraph(dataBy_Season);

									// Datasets for the line graph.
									var data_for_line = d3.nest()
											.key(function (d) {
												//  Specifying how we want to do the grouping
												return d.League_to;
											})
											.key(function (e) {
												// Specifying the second grouping looking for.
												return e.Position;
											})
											.rollup(function (leaves) {
												//  Specifying what attribute to sum for the bar chart (Transfer_fee)
												return d3.sum(leaves, function (d) {
													//  Need to tranform numbers to int because they are strings now.
													return parseInt(d.Transfer_fee)

												})
											})
											.entries(data); // Specifying on what data to do the grouping

									var domain_x = d3.nest()
											.key(function (e) {
												// Specifying the second grouping looking for.
												return e.Position;
											})
											.rollup(function (leaves) {
												//  Specifying what attribute to sum for the bar chart (Transfer_fee)
												return d3.sum(leaves, function (d) {
													//  Need to tranform numbers to int because they are strings now.
													return parseInt(d.Transfer_fee)

												})
											})
											.entries(data); // Specifying on what data to do the grouping
									// Function to draw a bar graph.
									drawLineGraph(data_for_line, domain_x, league_Selected);
								});
					};

					// Create the Bar Graph.
					function drawBarGraph(data) {
						document.getElementById("Bar_Chart").innerHTML = "";

						// DATA IS BEING USED TO PLOT NOW.

						// X-AXIS creation and domain.
						// Creating the width of all bar chart and padding between each bar
						var yScale = d3.scaleBand().range([0, height]).padding(0.1);
						// Giving the domain of the x-axis
						yScale.domain(data.map(function (d) { return d.key; }));

						//Y-AXIS creation and domain
						var xScale = d3.scaleLinear().range([0, width]);
						// Giving the domain from 0(since no transfers = 0) to the maximum transfer sum season.
						xScale.domain([0, d3.max(data, function (d) { return parseInt(d.value); })]);


						// Creation of svg element.
						var svg = d3.select("#Bar_Chart")
								.append('svg')
								.attr('height', height + margin.top + margin.bottom)
								.attr("width", width + margin.left + margin.right)
								.append("g")
								.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

						// to be able to use x axis to css
						svg.append("g")
								.attr("class", "x axis")
								.attr("transform", "translate(0, " + height + ")")
								.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
								.selectAll("text")
								.attr("transform", "translate(-10,0)rotate(-45)")
								.style("text-anchor", "end");

						// to be able to use y axis to css
						svg.append("g")
								.attr("class", "y axis")
								.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
								.append("text")
								.attr("transform", "rotate(-90)")
								.attr("y", 6)
								.attr("dy", ".71em")
								.style("text-anchor", "end");
						/**
						 * STILL NEED TO PUT GOOD LABELS ON AXIS AND TITLE TO BE MORE FRIENDLY
						 **/

						// Selecting or bars created from scaleBand. One bar for each value in domain.
						svg.selectAll("bar")
								.data(data) // Data being used.
								.enter().append("rect") // Each bar create rectangle
								.style("fill", "steelblue")
								.attr("class", "bar")
								.attr("x", xScale(0)) // Placing bar at value xScale on x axis
								.attr("y", function (d) { return yScale(d.key); }) // Ending height at value yScale on y axis
								.attr("width", function (d) {return xScale(d.value)}) // Specifyin the width of each bar according to the bar widths (finds it auto)
								.attr("height", yScale.bandwidth());


					}

				</script>

			</div>


		</div>

		<div class="column right">
			<!-- Line graph of different leagues will appear -->
			<div id="Line_Chart" style="width: 100%; height: 100%;">

				<script>
					function drawLineGraph(data_for_line, domain_x, league_Selected) {
						document.getElementById("Line_Chart").innerHTML = "";
						// Reading the data in the javascript enviroment.

									// Getting iterator index of the leagues interested in array frame.
									var iterator_interest = new Array();
									var i = 0;
									data_for_line.forEach(function (d) {
										if (league_Selected.includes(d.key)) {
											iterator_interest.push(i);
										}
										i = i + 1;
									});

									var final = new Array();
									iterator_interest.forEach(function (iter) {
										final.push(data_for_line[iter]);
									});

									/**
									 * Function for compare to sort the array of objects using each objects key.
									 * Code was found from https://www.sitepoint.com/sort-an-array-of-objects-in-javascript/
									 * Using code from here to do the sorting.
									 */
									function compare(a, b) {
										// Use toUpperCase() to ignore character casing
										const keyA = a.key.toUpperCase();
										const keyB = b.key.toUpperCase();

										let comparison = 0;
										if (keyA > keyB) {
											comparison = 1;
										} else if (keyA < keyB) {
											comparison = -1;
										}
										return comparison;
									}

									// Sorting each object (each league) according to position of player.
									final.forEach(function (d) {
										d.values.sort(compare);

									});


									// X-AXIS creation and domain.
									// Creating x axis scale and domain.
									var positions = new Array()
									domain_x.forEach(function (d) {
										positions.push(d.key);
									});

									// Using scale point so lines are plotted more precisely.
									var xScale = d3.scalePoint()
											.range([10, width + 10]) // Start from 50 because dont want both axis to be stuck.
											.domain(positions.sort());

									// Y-AXIS creation and domain.
									var transfer_per = new Array();
									final.forEach(function (d) {
										(d.values).forEach(function (e) {
											transfer_per.push(e.value);
										})
									});

									// Getting the y axis creation and domain.
									var y_ax = d3.extent(transfer_per, function (d) {
										return parseInt(d);
									});
									var yScale = d3.scaleLinear()
											.range([height, 0])
											.domain(y_ax);


									// Creation of svg element.
									var svgLine = d3.select("#Line_Chart")
											.append('svg')
											.attr('class', 'LineSVG')
											.attr('height', height + margin.top + margin.bottom)
											.attr("width", width + margin.left + margin.right)
											.style("margin-left", margin.left)
											.append("g")
											.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

									// to be able to use x axis to css
									// and plotting
									svgLine.append("g")
											.attr("class", "x axis")
											.attr("transform", "translate(0, " + height + ")")
											.call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
											.selectAll("text")
											.style("text-anchor", "end") // labels the axis all below the line
											.attr("dx", "-.8em")
											.attr("dy", "-.55em")
											.attr("transform", "rotate(-90)"); // rotates the labels to be vertical

									// to be able to use y axis to css
									// and plotting
									svgLine.append("g")
											.attr("class", "y axis")
											.call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
											.append("text")
											.attr("transform", "rotate(-90)")
											.attr("y", 6)
											.attr("dy", ".71em")
											.style("text-anchor", "end");


									// Appending points for Laliga
									svgLine.selectAll("liga-dots")
											.data(final[0].values) // Data being used.
											.enter()
											.append("svg:circle")
											.attr("class", "Laliga")
											.attr("cx", function (d) {
												return xScale(d.key);
											})
											.attr("cy", function (d) {
												return yScale(parseInt(d.value))
											})
											.attr("r", 5)
											.on("mouseover", function (d) {
												d3.select('.LineSVG')
														.append("text")
														.attr("class", "tooltip")
														.text("LaLiga spend : " + parseInt(d.value / 1000000) + "M on position : " + d.key)
														.attr("x", xScale(d.key))
														.attr("y",
																yScale(parseInt(d.value)) + 70);

											})
											.on("mouseout", function (d) {
												d3.selectAll(".tooltip")
														.remove();
											});

									// Appending points for Serie A league.
									svgLine.selectAll("serie-dots")
											.data(final[1].values) // Data being used.
											.enter()
											.append("circle")
											.attr("class", "SerieA")
											.attr("cx", function (d) {
												return xScale(d.key);
											})
											.attr("cy", function (d) {
												return yScale(parseInt(d.value))
											})
											.attr("r", 5)
											.on("mouseover", function (d) {
												d3.select('.LineSVG')
														.append("text")
														.attr("class", "tooltip")
														.text("Serie A spend : " + parseInt(d.value / 1000000) + "M on position : " + d.key)
														.attr("x", xScale(d.key))
														.attr("y",
																yScale(parseInt(d.value)) + 70);

											})
											.on("mouseout", function (d) {
												d3.selectAll(".tooltip")
														.remove();
											});


									// Appending points for Ligue 1 league.
									svgLine.selectAll("ligue-dots")
											.data(final[2].values) // Data being used.
											.enter()
											.append("circle")
											.attr("class", "Ligue1")
											.attr("cx", function (d) {
												return xScale(d.key);
											})
											.attr("cy", function (d) {
												return yScale(parseInt(d.value))
											})
											.attr("r", 5)
											.on("mouseover", function (d) {
												d3.select('.LineSVG')
														.append("text")
														.attr("class", "tooltip")
														.text("Ligue 1 spend : " + parseInt(d.value / 1000000) + "M on position : " + d.key)
														.attr("x", xScale(d.key))
														.attr("y", yScale(parseInt(d.value)) + 70);

											})
											.on("mouseout", function (d) {
												d3.selectAll(".tooltip")
														.remove();
											});

									// Appending points for Premier league.
									svgLine.selectAll("premier-dot")
											.data(final[3].values) // Data being used.
											.enter()
											.append("circle")
											.attr("class", "Premier")
											.attr("cx", function (d) {
												return xScale(d.key);
											})
											.attr("cy", function (d) {
												return yScale(parseInt(d.value))
											})
											.attr("r", 5)
											.on("mouseover", function (d) {
												d3.select('.LineSVG')
														.append("text")
														.attr("class", "tooltip")
														.text("Premier League spend : " + parseInt(d.value / 1000000) + "M on position : " + d.key)
														.attr("x", xScale(d.key))
														.attr("y", yScale(parseInt(d.value)) + 70);

											})
											.on("mouseout", function (d) {
												d3.selectAll(".tooltip")
														.remove();
											});

									// Appending points for Bundesliga.
									svgLine.selectAll("bundes-dot")
											.data(final[4].values) // Data being used.
											.enter()
											.append("circle")
											.attr("class", "Bundesliga")
											.attr("cx", function (d) {
												return xScale(d.key);
											})
											.attr("cy", function (d) {
												return yScale(parseInt(d.value))
											})
											.attr("r", 5)
											.on("mouseover", function (d) {
												d3.select('.LineSVG')
														.append("text")
														.attr("class", "tooltip")
														.text("Bundesliga spend : " + parseInt(d.value / 1000000) + "M on position : " + d.key)
														.attr("x", xScale(d.key))
														.attr("y", yScale(parseInt(d.value)) + 70);

											})
											.on("mouseout", function (d) {
												d3.selectAll(".tooltip")
														.remove();
											});
					}

				</script>

			</div>
		</div>
	</div>


</body>

</html>