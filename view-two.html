<html>

<head>
	<script src="https://d3js.org/d3.v5.js"></script>
	<title> View-Two </title>

	<style>

	</style>

</head>

<!-- Script organizing the data to visualize later. -->
<script>

	var dataPath = "data/updated_data.csv";

	var margin = 100;	//margins the left
	var width = 800;	//width of the svg element (in pixels)
	var height = 400; //height of the svg element


	// <!-- Reading the data in the javascript enviroment. -->
	d3.csv(dataPath)
		.then(function (data) {
			// <!-- Printing in console to make sure all working correct -->
			console.log(data);

			// <!-- Because we want to create a bar chart for the sum(fees) for every season -->
			// <!-- We need to use nest() to group data according to the season of the observation -->
			var nestedBar = d3.nest()
				.key(function (d) {
					// <!-- Specifying how we want to do the grouping -->
					return d.Season;
				})
				.rollup(function (leaves) {
					// <!-- Specifying what attribute to sum for the bar chart (Transfer_fee) -->
					return d3.sum(leaves, function (d) {
						// <!-- Need to tranform numbers to int because they are strings now. -->
						return parseInt(d.Transfer_fee);
					})
				})
				.entries(data); // <!-- Specifying on what data to do the grouping -->





			// <!-- Printing new nested data in console to check if correct -->
			console.log(nestedBar);


			<!-- Getting scale of x axes, of minimum to maximum date -->
			var extendTime  = d3.extent(data, function (d) {return d.Season;});
			console.log(extendTime);

			<!-- x axes scale creation -->
			var xScale = d3.scaleBand()
					.domain(extendTime)
					.range([0, width]);

			// <!-- y axes scale creation -->

			var transferFees = new Array();

			nestedBar.forEach(function (d) {
				transferFees.push(d.value)
			});


			var extendMoney = d3.extent(transferFees, function (d) { return parseInt(d); });

			var yScale = d3.scaleLinear()
				.domain(extendMoney)
				.range([height, 0]);



			var x_axis = d3.axisBottom(xScale);
			var y_axis = d3.axisLeft(yScale);

			var svg = d3.select("#Bar_Chart")
					.append('svg')
					.attr('height', height + margin)
					.attr('width', width + margin);

			svg.append("g")
					.attr("class", "x axis")
					.attr("transform", "translate("+margin+","+height+")")
					.call(x_axis);

			svg.append("g")
					.attr("class", "y axis")
					.attr("transform", "translate("+margin+",0)")
					.call(y_axis);

			var lineTrans = d3.line()
					.x(function (d) {
						return margin+xScale(d.key);

					})
					.y(function(d) {
						return yScale(parseInt(d.value));
					});

			svg.append("path")
					.datum(nestedBar.values)
					.attr("class", "line")
					.attr("d", lineTrans);


		});
</script>

<body>
	<!-- This is going to become a header of the page or navigation panel. -->
	<a href="index.html">Click to go to Home page</a> <br>
	<a href="view-one.html">Click to see view one</a> <br>
	<a href="view-two.html">Click to see view two</a>
	<h2>Second view of data here.</h2>

	<!-- Visualisation will be appeared. -->
	<div id="Bar_Chart">

	</div>

</body>

</html>