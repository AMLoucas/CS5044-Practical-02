<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title>View One</title>
</head>

<!-- Load color scale -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
<style>
	html {
		min-height: 100%;
		height: 100%;
		width: 100%;
	}

	body {
		min-height: 100%;
		height: 100%;
		width: 100%;
	}

	.row {
		min-height: 80%;
		height: 80%;
		width: 100%;
	}

	* {
		box-sizing: border-box;
	}

	/* Create three unequal columns that floats next to each other */
	.column {
		float: left;
		padding: 10px;
	}

	/* This is the filter column */
	.left {
		width: 15%;
		border-right-width: thin;
		border-right-style: solid;
		height: 115%;
		text-align: left;

	}

	/* Plot columns. Middle = BarGraph, Right = Scatter */
	.middle, .right {
		width: 35%;
		height: 90%;

	}

	/* Clear floats after the columns */
	.row:after {
		content: "";
		display: table;
		clear: both;
	}

	.line_graph {
		width: 90%;
		height: 90%;
		align-items: center;
	}

	/* To give different colours to the data points in scatter. */
	/* Each league to have a unique scatter plot */
	path[name^="LaLiga"] {
		stroke: red;
		stroke-width: 1.5px;
		fill: none;
		opacity: 0.75;

	}

	path[name^="Premier"] {
		stroke: blue;
		stroke-width: 1.5px;
		fill: none;
		opacity: 0.75;
	}

	path[name^="1.Bunde"] {
		stroke: black;
		stroke-width: 1.5px;
		fill: none;
		opacity: 0.75;
	}

	path[name^="Serie A"] {
		stroke: green;
		stroke-width: 1.5px;
		fill: none;
		opacity: 0.75;
	}

	path[name^="Ligue"] {
		stroke: orange;
		stroke-width: 1.5px;
		fill: none;
		opacity: 0.75;
	}


</style>

<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li class="current"><a href="view-one.html">View One</a></li>
			<li><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>

	<div class="row">
		<div class="column left">
			<h3>Choose League(s):</h3>
			<form id="league-range">
				<input type="checkbox" id="league3" value="1.Bundesliga" onchange="cleanDataToDraw()" checked>
				<label for="league3">Bundesliga</label><br>
				<input type="checkbox" id="league5" value="LaLiga" onchange="cleanDataToDraw()" checked>
				<label for="league5">LaLiga</label><br>
				<input type="checkbox" id="league2" value="Ligue 1" onchange="cleanDataToDraw()" checked>
				<label for="league2">Ligue 1</label><br>
				<input type="checkbox" id="league1" value="Premier League" onchange="cleanDataToDraw()" checked>
				<label for="league1">Premier League</label><br>
				<input type="checkbox" id="league4" value="Serie A" onchange="cleanDataToDraw()" checked>
				<label for="league4">Serie A</label><br>

			</form>
		</div>

		<div class="column middle">
			<!-- Create a div where the graph will take place -->
			<div id="line_graph" class="line_graph">

			</div>

		</div>

		<div class="column right">

			<!-- Create a div where the graph will take place -->
			<div id="lollipop_graph" class="lollipop_graph">

			</div>

		</div>
	</div>





</body>

<script>
	/**
	 * GLOBAL VARIABLES THAT WILL BE USED IN PLOTTING
	 **/

	var dataPath = "data/top250-00-19.csv";

    // Margin variable to use to position visualisation more precise
    var margin = { top: 75, bottom: 100, left: 75, right: 50};
    // Getting height and width of the div elements the graphs will be inputted in.
    var width = document.getElementById('line_graph').getBoundingClientRect().width;	//width of the svg element (in pixels)
    var height = document.getElementById('line_graph').getBoundingClientRect().height ; //height of the svg element

    // Calling function to draw the graphs needed.
    cleanDataToDraw();

    function cleanDataToDraw() {

        /**
         * FILTERING DATA ACCORDING TO CHECKBOXES CHECKED FROM USER.
         **/


            // Getting the data according to the leagues interested in.
        var top_five = new Array();
        // Loop through all top 5 leagues to check if checkboxes are checked (user wants)
        for (var i = 1; i<=5; i++) {
            // Creating the string to check for a specific league if box checked
            var league = "league"+i;
            // If the specific checkbox is checkes then we add the value in array.
            if (document.getElementById(league).checked) {
                top_five.push(document.getElementById(league).value);
            }
        }

        // Reading the data in the javascript environment for bar graph.
        d3.csv(dataPath)
            .then(function (data) {
                // Use of anonymous function
                // Filtering data and removing all records with seasons not interested in.
               // data = data.filter(season => season_Selected.includes(season.Season));
                // Including data only involved with top 5 leagues transfer ins.
                data = data.filter(league => top_five.includes(league.League_to));

				// Aggregating the data in correct format to plot the data.
				// We group each league with season-sum(transfer) pairs.
                var dataFor_Line = d3.nest()
                    .key(function (d) {
                            return d.League_to;
                    })
					.key(function (d) {
					    return d.Season;
					})
                    .rollup(function (leaves) {
                        //  Specifying what attribute to sum for the bar chart (Transfer_fee)
                        return d3.sum(leaves, function (d) {
                            //  Need to tranform numbers to int because they are strings now.
                            return parseInt(d.Transfer_fee)

                        })
                    })
                    .entries(data); // Specifying on what data to do the grouping

				// Print to see the resulted array.
				console.log(dataFor_Line);

                // We need to nest the data again to get the correct domain for x of the line graph.
                var domain_x = d3.nest()
                    .key(function (e) {
                        // Our x_domain will be the season.
                        return e.Season;
                    })
                    .rollup(function (leaves) {
                        // Our y domain will be transfer fee
                        return d3.sum(leaves, function (d) {
                            //  Need to tranform numbers to int because they are strings now.
                            return parseInt(d.Transfer_fee);

                        })
                    })
                    .entries(data); // Specifying on what data to do the grouping

				// Print to see the resulted array
				console.log(domain_x);

                // Function to draw a line graph
                drawSeasonLine(dataFor_Line, domain_x);

                // Creating aggregating data to create the lollipop
                var dataFor_Lollipop = d3.nest()
					.key(function(d) {
					    return d.Position;
					})
					.rollup(function(leaves) {
					    return d3.sum(leaves, function(d) {
					        return parseInt(d.Transfer_fee);
						})
					})
					.entries(data);

                // Print the data to see the resulted array
				console.log(dataFor_Lollipop);

				// Function to draw the lollipop
				drawLollipop(dataFor_Lollipop);


            });
    }

    function drawSeasonLine(dataFor_Line, domain_x) {

        // Removing previous data to create new state.
        document.getElementById("line_graph").innerHTML = "";


        /**
		 * X-AXIS CONSTRUNCTION
         */

        // Computing the correct domain fo x-axis.
        var seasons = new Array()
        domain_x.forEach(function (d) {
            seasons.push(d.key);
        });

        // Using scale point so lines are plotted more precisely.
        var xScale = d3.scalePoint()
            .range([10, width + 10]) // Start from 10 because want small separation of axis.
            .domain(seasons.sort());


        /**
		 * Y-AXIS CONSTRUCTION
         */

        // Computing correct domain for y-axis.
        var trasnfer_fees = new Array();
        dataFor_Line.forEach(function (d) {
            // For each league in data go through each season transfer fee
            (d.values).forEach(function (e) {
                // append all the values of all transfer fees of all seasons for each team.
                trasnfer_fees.push(e.value);
            })
        });

        // Getting the minimum transfer fee and the maximum.
        var min_max_fee = d3.extent(trasnfer_fees, function (d) {
            return parseInt(d);
        });

        // Since the transfer fees is a continuous scale, we will scale linear.
        var yScale = d3.scaleLinear()
            .range([height, 0])
            .domain(min_max_fee);

        /**
		 * Creating graph area and axis in position
         */

        // Creation of svg element.
        var line_Graph = d3.select("#line_graph")
            .append('svg')
            .attr('class', 'plot_element')
            .attr('height', height + margin.top + margin.bottom)
            .attr("width", width + margin.left + margin.right)
            .style("margin-right", margin.right)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        /**
		 * Adding the X-AXIS on the plot.
         */

        // Adding the x-axis with labels on element
        line_Graph.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0, " + height + ")")
            .call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
            .selectAll("text")
            .attr("dx", "-.8em")
            .attr("dy", "-.55em")
            .attr("transform", "translate(5, 0)rotate(-45)")
            .style("text-anchor", "end");

        // Adding title for the x-axis.
        line_Graph.append("text")
            .attr("transform",
                "translate(" + (width / 2) + " ," +
                (height + margin.top) + ")")
            .style("text-anchor", "middle")
            .text("SEASON");

        /**
		 * Adding the Y-AXIS on the plot.
         */

        // Adding the y-axis and its labels on element.
        line_Graph.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(yScale)); // Specifying y-axis to be on left.

        // Adding a title for the y-axis.
        line_Graph.append("text")
            .attr("y", -5)
            .attr("x", +5)
            .style("text-anchor", "middle")
            .style("font-size", "1em")
            .text("TRANSFER FEE'S (€)");

        /**
		 * Adding a plot title for the graph.
         */
        line_Graph.append("text")
            .attr("class", "title")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2))
            .attr("text-anchor", "middle")
            .style("font-size", "20px")
            .text("TRANSFER FEES SPEND(€) BY EACH LEAGUE & SEASON");

        /**
		 * Create a line object.
		 * Function will be in charge of creating the appropriate line for each league.
         */

        for (var pointer = 0; pointer < dataFor_Line.length; pointer++) {

            // Add the line
            line_Graph.append("path")
				.attr("name", dataFor_Line[pointer].key)
                .datum(dataFor_Line[pointer].values)
                .attr("fill", "none")
                .attr("stroke-width", 1.5)
                .attr("d", d3.line()
                    .x(function(d) { return xScale(d.key) })
                    .y(function(d) { return yScale(d.value) })
                )
        }

    }

    function drawLollipop(dataFor_Lollipop) {

        // Removing previous data to create new state.
        document.getElementById("lollipop_graph").innerHTML = "";


        /**
         * X-AXIS CONSTRUNCTION
         */

        // Computing the correct domain fo x-axis
        var transfer = new Array();
        dataFor_Lollipop.forEach(function (d) {
            transfer.push(d.value);
        });

        // Getting the minimum transfer fee and the maximum.
        var min_max_fee = d3.extent(transfer, function (d) {
            return parseInt(d);
        });

        // Since transfer fee is linear, we are scaling linearly.
        var xScale = d3.scaleLinear()
            .range([0, width])
            .domain(min_max_fee);


        /**
         * Y-AXIS CONSTRUCTION
         */

        // Calculating the corect scale for y axis
			// Doing it this way manually so it can be sorted.
		var positions = new Array();
        dataFor_Lollipop.forEach(function (d) {
            positions.push(d.key);
        });

        // To divide y-axis in bands of equal spaces and distances.
        var yScale = d3.scaleBand()
            .range([0, height])
            .domain(positions.sort())
            .padding(1);

        /**
         * Creating graph area and axis in position
         */

            // Creation of svg element.
        var lollipop_Graph = d3.select("#lollipop_graph")
                .append('svg')
                .attr('class', 'plot_element')
                .attr('height', height + margin.top + margin.bottom)
                .attr("width", width + margin.left + margin.right)
                .style("margin-left", margin.left)
                .append("g")
                .attr("transform", "translate(" + (margin.left + 15) + "," + margin.top + ")");

        /**
         * Adding the X-AXIS on the plot.
         */

        // Adding the x-axis with labels on element
        lollipop_Graph.append("g")
            .attr("class", "x axis")
            .attr("transform", "translate(0, " + height + ")")
            .call(d3.axisBottom(xScale)) // Specifying x-axis to be on bottom.
            .selectAll("text")
            .attr("transform", "translate(5, 0)rotate(-45)")
            .style("text-anchor", "end");


        // Adding title for the x-axis.
        lollipop_Graph.append("text")
            .attr("transform",
                "translate(" + (width / 2) + " ," +
                (height + margin.top) + ")")
            .style("text-anchor", "middle")
            .text("TRANSFER FEE'S (€)");

        /**
         * Adding the Y-AXIS on the plot.
         */

        // Adding the y-axis and its labels on element.
        lollipop_Graph.append("g")
            .attr("class", "y axis")
            .call(d3.axisLeft(yScale)) // Specifying y-axis to be on left.
			.style("text-anchor", "end");


        // Adding a title for the y-axis.
        lollipop_Graph.append("text")
            .attr("y", -5)
            .attr("x", +5)
            .style("text-anchor", "middle")
            .style("font-size", "1em")
            .text("PLAYER'S POSITION");

        /**
         * Adding a plot title for the graph.
         */
        lollipop_Graph.append("text")
            .attr("class", "title")
            .attr("x", (width / 2))
            .attr("y", 0 - (margin.top / 2))
            .attr("text-anchor", "middle")
            .style("font-size", "20px")
            .text("TRANSFER FEES SPEND(€) BY EACH POSITION");

        /**
         * Function that will fit a lollipo
		 * Lollipop is constructed by a line and a circle.
         */

        // Lines
        lollipop_Graph.selectAll("myline")
            .data(dataFor_Lollipop)
            .enter()
            .append("line")
            .attr("x1", function(d) { return xScale(d.value); })
            .attr("x2", xScale(0))
            .attr("y1", function(d) { return yScale(d.key); })
            .attr("y2", function(d) { return yScale(d.key); })
            .attr("stroke", "grey");

		// Circles
        lollipop_Graph.selectAll("mycircle")
            .data(dataFor_Lollipop)
            .enter()
            .append("circle")
            .attr("cx", function(d) { return xScale(d.value); })
            .attr("cy", function(d) { return yScale(d.key); })
            .attr("r", "7")
            .style("fill", "#69b3a2")
            .attr("stroke", "black");




    }


</script>

</html>