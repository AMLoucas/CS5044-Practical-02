<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="style.css">
	<script src="https://d3js.org/d3.v5.js"></script>
	<title>View One</title>
</head>

<!-- Load color scale -->
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>

<!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
<style>
	.bubbles {
	  stroke-width: 2px;
	  stroke: white;
	}
	.bubbles:hover {
	  stroke: black;
	}
</style>

<body>
	<nav id="navbar">
		<ul>
			<li><a href="index.html">Home</a></li>
			<li class="current"><a href="view-one.html">View One</a></li>
			<li><a href="view-two.html">View Two</a></li>
		</ul>
	</nav>

	<h2>First view of the data.</h2>

	<!-- Create a div where the graph will take place -->
	<div id="bubble_chart"></div>

</body>

<script>
	let dataPath = "data/top250-00-19.csv";

	// Setting the margins, width and height of the graph
	var margin = {top: 10, right: 20, bottom: 30, left: 50},
    width = 500 - margin.left - margin.right,
    height = 420 - margin.top - margin.bottom;

	// Appending the SVG to the body of the page
	var svg = d3.select("#bubble_chart")
		.append("svg")
			.attr("width", width + margin.left + margin.right)
			.attr("height", height + margin.top + margin.bottom)
		.append("g")
			.attr("transform",
				"translate(" + margin.left + "," + margin.top + ")");
	
	// Loading the data
	d3.csv('data/updated_data.csv', data => {
		// Add X axis
		var x = d3.scaleLinear()
			.domain([0, 12000])
			.range([ 0, width ]);
		svg.append("g")
			.attr("transform", "translate(0," + height + ")")
			.call(d3.axisBottom(x));

		// Add Y axis
		var y = d3.scaleLinear()
			.domain([35, 90])
			.range([ height, 0]);
		svg.append("g")
			.call(d3.axisLeft(y));

		// Add a scale for bubble size
		var z = d3.scaleLinear()
			.domain([200000, 1310000000])
			.range([ 4, 40]);


		// Add a scale for bubble color
		var myColor = d3.scaleOrdinal()
			.domain(["Premier League", "LaLiga", "Serie A", "1.Bundesliga", "Ligue 1"])
			.range(d3.schemeSet2);

		// -1- Create a tooltip div that is hidden by default:
		var tooltip = d3.select("#bubble_chart")
			.append("div")
			.style("opacity", 0)
			.attr("class", "tooltip")
			.style("background-color", "black")
			.style("border-radius", "5px")
			.style("padding", "10px")
			.style("color", "white")

		// -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
		var showTooltip = function(d) {
			tooltip
			.transition()
			.duration(200)
			tooltip
			.style("opacity", 1)
			.html("League: " + d.League_to)
			.style("left", (d3.mouse(this)[0]+30) + "px")
			.style("top", (d3.mouse(this)[1]+30) + "px")
		}
		var moveTooltip = function(d) {
			tooltip
			.style("left", (d3.mouse(this)[0]+30) + "px")
			.style("top", (d3.mouse(this)[1]+30) + "px")
		}
		var hideTooltip = function(d) {
			tooltip
			.transition()
			.duration(200)
			.style("opacity", 0)
		}

		// Add dots
		svg.append('g')
			.selectAll("dot")
			.data(data)
			.enter()
			.append("circle")
			.attr("class", "bubbles")
			.attr("cx", function (d) { return x(d.Season); } )
			.attr("cy", function (d) { return y(d.Transfer_fee); } )
			.attr("r", function (d) { return z(d.Position); } )
			.style("fill", function (d) { return myColor(d.League_to); } )
			// -3- Trigger the functions
			.on("mouseover", showTooltip )
			.on("mousemove", moveTooltip )
			.on("mouseleave", hideTooltip )
	})
</script>

</html>